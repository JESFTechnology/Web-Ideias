<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Calendar</title>
</head>
<body>
    <header class="fixed-top">
        <nav class="navbar navbar-expand-md px-4">
            <div class="navbar-brand">
                <a href="#home"><img class="" src="" alt=""></a>
                <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#menubar"><span
                        class="fa-solid fa-bars"></span></button>
            </div>

            <div class="collapse navbar-collapse" id="menubar">
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="index.html" class="nav-link text-white">Início</a></li>
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link text-white dropdown-toggle" data-bs-toggle="dropdown">Nossos
                            projetos</a>
                        <ul class="dropdown-menu p-3">
                            <li><a href="html/projects/impressoes.html" class="dropdown-item text-white">Impressões
                                    3D</a></li>
                            <li><a href="html/projects/reciclagem.html" class="dropdown-item text-white">Reciclagem
                                    3D</a></li>
                            <li><a href="html/projects/autismo.html" class="dropdown-item text-white">Autismo
                                    3D</a></li>
                            <li><a href="html/projects/moldelagem.html" class="dropdown-item text-white">Moldelagem
                                    3D</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link text-white dropdown-toggle" data-bs-toggle="dropdown">Download</a>
                        <ul class="dropdown-menu p-3">
                            <li><a href="html/downloads/software.html" class="dropdown-item text-white">Softwares</a>
                            </li>
                            <li><a href="html/downloads/firmware.html" class="dropdown-item text-white">Firmwares</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item"><a href="contato.html" class="nav-link text-white">Contato</a></li>

                </ul>
            </div>

            <div class="m-auto">
                <span class="fa-solid text-white mx-5" id="temperature"></span>
                <a href="#"><span class="fa-brands fa-facebook-square text-white"></span></a>
                <a href="#"><span class="fa-brands fa-instagram-square  text-white ms-2"></span></a>
                <a href="#"><span class="fa-brands fa-twitter-square  text-white ms-2"></span></a>
            </div>
        </nav>
    </header>
    <h1 class="m-5 text-center">Calendário de trabalho</h1>
    <div class="calendar">
        <div class="header-2">
            <button class="prev" onclick="prevMonth()">«</button>
            <span id="month"></span>
            <button class="next" onclick="nextMonth()">»</button>
        </div>
        <div class="days-2">
            <div class="day-2" id="day-0">D</div>
            <div class="day-2" id="day-1">S</div>
            <div class="day-2" id="day-2">T</div>
            <div class="day-2" id="day-3">Q</div>
            <div class="day-2" id="day-4">Q</div>
            <div class="day-2" id="day-5">S</div>
            <div class="day-2" id="day-6">S</div>
        </div>
        <div class="dates-2">
            <!-- Os dias do mês serão renderizados aqui -->
        </div>
        <div class="dates-info">
            <p>Ocupado</p>
            <div class='date-2 bg-danger-2 text-white-2'></div>
        </div>
        <div class="dates-info">
            <p>Livre</p>
            <div class='date-2 text-white-2'></div>
        </div>
        <div class="dates-info">
            <p>Indisponível</p>
            <div class='date-2 bg-warning-2 text-white-2'></div>
        </div>
        <div class="dates-info">
            <p>Online</p>
            <div class='date-2 bg-info-2 text-white-2'></div>
        </div>
    </div>

    <script>
        const diasOcupados = [
        ];
        let SHEET_ID = '1aASoEKK2ZGR0mJpz_5oSUf6shdo_tDwQEP2ZwxpiTvY'
        let SHEET_TITLE = 'EscolasECursos';
        let SHEET_RANGE = 'F2:F100';
        const FULL_URL = ('https://docs.google.com/spreadsheets/d/' + SHEET_ID + '/gviz/tq?sheet=' + SHEET_TITLE + '&range=' + SHEET_RANGE);
        fetch(FULL_URL)
            .then(res => res.text())
            .then(rep => {
                let data = JSON.parse(rep.substr(47).slice(0, -2));

                console.log("Google Online!");

                const carousel_inner = document.getElementById('carousel_inner');
                const carousel_indicators = document.getElementById('carousel_indicators');

                let length = data.table.rows.length;

                for (let x = 0; x < length; x++) {
                    const texto = `${data.table.rows[x].c[0].v}`;
                    const regex = /\((\d{4}),(\d{1,2}),(\d{1,2})\)/;
                    const match = texto.match(regex);
                    if (match) {
                        const ano = match[1];
                        const mes = match[2].padStart(2, '0');
                        const dia = match[3].padStart(2, '0');
                        const dataFormatada = `${ano}-${mes}-${dia}`;
                        diasOcupados.push(dataFormatada)
                    }
                }
            });

        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        const daysOfWeek = ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado'];
        const today = new Date();
        const dayOfWeek = daysOfWeek[today.getDay()];
        const dia = today.getDate();
        const mes = today.getMonth();

        function renderCalendar() {
            const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            const daysInMonth = getDaysInMonth(currentMonth, currentYear);
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();

            document.getElementById("month").innerText = monthNames[currentMonth] + " " + currentYear;

            let html = "";

            for (let i = 0; i < firstDayOfMonth; i++) {
                html += "<div class='date-2'></div>";
            }

            for (let i = 1; i <= daysInMonth; i++) {
                const diaEscolhido = `${currentYear}-${currentMonth}-${i}`; // Dia que você deseja verificar
                if (isDiaOcupado(diaEscolhido)) {
                    if (dia == i && currentMonth == mes) {
                        html += "<div class='date-2 bg-danger text-white-2 border-warning-2'>" + i + "</div>";
                    } else {
                        html += "<div class='date-2 bg-danger text-white-2'>" + i + "</div>";
                    }
                } else {
                    const dataDeConfirma = new Date(currentYear, currentMonth, i); // Data específica
                    const conferir = dataDeConfirma.getDay();
                    const diaDaSemana = daysOfWeek[conferir]
                    if (dia == i && currentMonth == mes) {
                        if (diaDaSemana == 'Domingo' || diaDaSemana == 'Quarta-feira') {
                            html += "<div class='date-2 border-warning-2 bg-warning-2'>" + i + "</div>";
                        } else if (diaDaSemana == 'Sábado') {
                            html += "<div class='date-2 border-warning-2 bg-info-2'>" + i + "</div>";
                        } else {
                            html += "<div class='date-2 border-warning-2'>" + i + "</div>";
                        }
                    } else {
                        if (diaDaSemana == 'Domingo' || diaDaSemana == 'Quarta-feira') {
                            html += "<div class='date-2 bg-warning-2'>" + i + "</div>";
                        } else if (diaDaSemana == 'Sábado') {
                            html += "<div class='date-2 bg-info-2'>" + i + "</div>";
                        } else {
                            html += "<div class='date-2'>" + i + "</div>";
                        }
                    }
                }
                if (i == daysInMonth) {
                    const dataDeConfirma = new Date(currentYear, currentMonth, i); // Data específica
                    const conferir = dataDeConfirma.getDay();
                    const diaDaSemana = daysOfWeek[conferir]
                    if (diaDaSemana != 'Domingo' && diaDaSemana != 'Sábado') {
                        for (let x = conferir; x < 6; x++) {
                            html += "<div class='date-2'></div>";
                        }
                    }
                }
            }

            document.querySelector(".dates-2").innerHTML = html;
        }

        function getDaysInMonth(month, year) {
            return new Date(year, month + 1, 0).getDate();
        }

        function prevMonth() {
            let mesAtual = new Date().getMonth();
            currentMonth--;
            if (currentMonth < mesAtual) {
                currentMonth++;
                return;
            }
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        function isDiaOcupado(dia) {
            const date = new Date(dia);
            const diaFormatado = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            return diasOcupados.includes(diaFormatado);
        }

        renderCalendar();
    </script>
</body>

</html>
